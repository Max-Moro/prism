# PRISM **XLSX-Adapter** – Roadmap

> Последнее обновление: 08 июл 2025  
> Файл обновляется после каждой итерации: строки из «Планируется» переносятся в «Сделано», при необходимости добавляются новые задачи.

---

## Стратегия релизов

* **Версии 0.x** — MVP-итерации: каждая минор-версия даёт работающий отчёт для всё большего подмножества сущностей.
* **Версия 1.0** — готова к внешним тендерам: полное покрытие SizingResult, RU + EN, корп. стиль, snapshot-CI.
* **Версии 1.x** — новые уровни (VM, Hardware) и оптимизация перформанса.

---

## Что **уже сделано** (v0.0, Sprint 0.1 – 0.2)

| Блок                          | Конкретные таски                                                                                                                                                                                                                                                                               | Описание реализации / отличия от плана |
|-------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|
| **Infrastructure skeleton**   | • Завели каталог `adapters/xlsx/` со структурой `src/ scripts/ tests/` по корпоративному шаблону.<br>• Мини-адаптер `XlsxAdapter` (создаёт книгу с ячейкой «Hello PRISM»).<br>• CLI `prism-cli report generate` + smoke-тест.<br>• `requirements*.txt`, `pytest.ini`, CI-workflow, pre-commit. | Реализовано без отклонений; в skeleton уже подключён Jinja-env и `openpyxl.write_only`, чтобы не менять интерфейс на следующих спринтах.                                                                                                                                       |
| **Таб «Totals» + zone-loop**  | • Парсинг `SizingResult` (dict) → агрегация CPU/RAM по зонам.<br>• Лист **Totals**: зона, CPU-req, Mem-req, CPU-lim, Mem-lim (Gi).<br>• CLI читает JSON-файл, валидирует наличие `"zones"`.<br>• Unit-тест `test_totals_values`: расшифровывает XLSX и проверяет содержимое таблицы.           | Отказались от байтовых snapshot-файлов (нестабильные метаданные Excel); вместо них проверяем фактические значения ячеек через `openpyxl`, что надёжнее и не ломается от timestamp-ов. Jinja-шаблон `totals.xml.j2` оставлен в репозитории на будущее, но пока не используется. |


---

## Что **планируется к реализации**

| Версия  | Спринты | Блок / Фича              | **Зависит от**                            | Критерии «Done»                                                                                                                  |
| ------- | ------- |--------------------------| ----------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------- |
| **0.3** | S-3     | Таб «Services» (3A/3B)   | 0.2                                       | • Сводная таблица service-level с группировкой по типу.<br>• Цветовая заливка по Layer-3A / 3B.<br>• Попадание стиля в snapshot. |
| **0.4** | S-4–5   | Infra-dependencies sheet | 0.3                                       | • PostgreSQL, Kafka, S3 объём / партиции.<br>• Проверка формул в snapshot.                                                       |
| **0.5** | S-6     | RU ↔ EN переключатель    | 0.4, готовый `locales` пакет              | • i18n с `gettext`; `pytest-snapshot` по двум языкам.<br>• CLI флаг `--lang`.                                                    |
| **0.6** | S-7     | Корпоративный стиль v1   | 0.5, согласованный `theme.yaml`           | • Колонтитулы, логотип, номера страниц.<br>• Настроенные шрифты.                                                                 |
| **0.7** | S-8     | Performance > 10k rows   | 0.6                                       | • Перевод builder на `write_only=True`.<br>• Benchmark < 5 с на 50k строк.                                                       |
| **1.0** | S-9–10  | Release-ready            | 0.7, Service endpoint                     | • Стаб. API `build_report()`.<br>• 90 % unit + snapshot-coverage.<br>• Демонстрация внешнему заказчику.                          |
| **1.1** | S-11    | VM-Layer support         | core-model 1.x                            | • Новый лист «VM sizing».                                                                                                        |
| **1.2** | S-12    | Hardware-Layer support   | 1.1                                       | • Новый лист «Hardware Bill of Materials».                                                                                       |

---

## Расширенный backlog

| Приор. | Блок / Фича               | Описание                                     | **Зависит от** | Пример ценности                   |
| ------ | ------------------------- | -------------------------------------------- | -------------- | --------------------------------- |
| **P0** | Snapshot-diff оптимизация | Использовать xlsx-hash + `xlrd` order-indep. | 0.2            | CI быстрее ×2                     |
| **P1** | Conditional formats       | Подсветка превышения limits / requests       | 0.3            | Менеджеру видно «красные» сервисы |
| **P1** | Column filters            | Включить автофильтры в шапках                | 0.3            | Быстрая навигация                 |
| **P2** | Dark theme                | Альтернативный дизайн для презентаций        | 0.6            | Бренд заказчика                   |
| **P2** | ODS export                | LibreOffice пользователи                     | 0.7            | Шире аудитория                    |

---
